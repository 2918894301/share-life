<view class="detail-container">
  <swiper class="image-swiper" style="height: {{swiperHeight}}px;" indicator-dots="{{true}}" autoplay="{{false}}" circular="{{true}}">
    <swiper-item wx:for="{{noteData.images}}" wx:key="index">
      <view class="swiper-item-container">
        <image src="{{item}}" mode="aspectFit" class="swiper-image" lazy-load="{{true}}" bindload="onImageLoad" bindtap="onImageTap" data-index="{{index}}" />
      </view>
    </swiper-item>
  </swiper>
  <view class="user-info">
    <view class="user-header">
      <view class="user-left">
        <view class="{{noteData.userInfo.avatar ? 'avatar' : 'avatar avatar-gradient'}}">
          <image wx:if="{{noteData.userInfo.avatar}}" src="{{noteData.userInfo.avatar}}" mode="aspectFill" />
        </view>
        <view class="user-meta">
          <text class="nickname">{{noteData.userInfo.nickname}}</text>
        </view>
      </view>
      <follow-button isFollowing="{{isFollowing}}" userId="{{noteData.userInfo.id}}" bind:followChange="handleFollowChange" />
    </view>
  </view>
  <view class="note-content">
    <view wx:if="{{noteData.title}}" class="note-title">
      <text class="title">{{noteData.title}}</text>
    </view>
    <text class="content">{{noteData.content}}</text>
    <view class="tags">
      <text class="tag" wx:for="{{noteData.tags}}" wx:key="index">#{{item}}</text>
    </view>
    <view class="publish-info">
      <text class="time">{{noteData.createTime}} {{noteData.location ? '·' : ''}}</text>
    </view>
  </view>
  <!-- 评论区域 -->
  <view class="comment-section">
    <view class="comment-header">
      <text class="comment-title">共 {{noteData.commentCount || 0}} 条评论</text>
    </view>
    <view class="comment-list">
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <view class="comment-user">
          <view class="user-avatar">
            <image class="avatar-img" src="{{item.userInfo.avatar}}" mode="aspectFill" />
          </view>
        </view>
        <view class="comment-content-wrapper">
          <view class="user-name">{{item.userInfo.nickname}}</view>
          <view class="comment-content">
            <view class="main-content">
              <text>{{item.content}}</text>
              <text class="comment-time">{{item.createTime}}</text>
            </view>
          </view>
          <view class="comment-actions">
            <view class="comment-like" wx:if="{{item.likeCount > 0}}">
              <text class="like-count">{{item.likeCount}}赞</text>
            </view>
          </view>
          <view class="replies-list" wx:if="{{item.replies && item.replies.length > 0}}">
            <view class="reply-item" wx:for="{{item.replies}}" wx:for-item="reply" wx:key="id">
              <view class="reply-user">
                <view class="reply-avatar">
                  <image class="avatar-img" src="{{reply.userInfo.avatar}}" mode="aspectFill" />
                </view>
              </view>
              <view class="reply-content-wrapper">
                <view class="reply-user-name">{{reply.userInfo.nickname}}</view>
                <view class="reply-content">
                  <view class="reply-main-content">
                    <text>{{reply.content}}</text>
                    <text class="reply-time">{{reply.createTime}}</text>
                  </view>
                </view>
                <view class="reply-actions">
                  <view class="reply-like" wx:if="{{reply.likeCount > 0}}">
                    <text class="reply-like-count">{{reply.likeCount}}赞</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      <view class="loading-tips" wx:if="{{comments.length > 0}}">
        <view wx:if="{{isLoading && hasMore}}" class="loading">加载中...</view>
        <view wx:if="{{!hasMore}}" class="no-more">没有更多评论了</view>
      </view>
      <view class="empty-tips" wx:if="{{comments.length === 0 && !isLoading}}">暂无评论，快来抢沙发吧~</view>
    </view>
  </view>
  <!-- 底部评论输入框组件 - 白色主题 -->
  <comment-input show="{{showCommentInput}}" noteId="{{noteData.id}}" replyToId="{{replyToId}}" replyToNickname="{{replyToNickname}}" placeholder="{{replyToId ? '回复评论...' : '说点什么...'}}" theme="light" hasActionBar="{{true}}" bind:success="onCommentSuccess" bind:error="onCommentError" bind:cancelReply="onCancelReply" />
</view>
<!-- 底部操作栏 -->
<action-bar noteId="{{noteData.id}}" isLiked="{{isLiked}}" isCollected="{{isCollected}}" likeCount="{{noteData.likeCount}}" collectCount="{{noteData.collectCount}}" commentCount="{{noteData.commentCount}}" bind:like="handleLike" bind:collect="handleCollect" bind:comment="handleComment" bind:share="handleShare" />